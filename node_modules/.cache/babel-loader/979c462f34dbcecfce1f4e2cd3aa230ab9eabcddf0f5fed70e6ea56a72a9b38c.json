{"ast":null,"code":"import _regeneratorRuntime from\"/home/workspace/reactjs/coding-practices/transactionmanagementapp/node_modules/.pnpm/@babel+runtime@7.22.6/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/workspace/reactjs/coding-practices/transactionmanagementapp/node_modules/.pnpm/@babel+runtime@7.22.6/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/workspace/reactjs/coding-practices/transactionmanagementapp/node_modules/.pnpm/@babel+runtime@7.22.6/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{createContext,useState,useContext}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),currentUser=_useState2[0],setCurrentUser=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAdmin=_useState4[0],setIsAdmin=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoggedIn=_useState6[0],setIsLoggedIn=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var login=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(email,password){var apiUrl,headers,formData,response,data,userId;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;apiUrl=\"https://bursting-gelding-24.hasura.app/api/rest/get-user-id\";headers={\"Content-Type\":\"application/json\",\"x-hasura-admin-secret\":\"g08A3qQy00y8yFDq3y6N1ZQnhOPOa4msdie5EtKS1hFStar01JzPKrtKEzYY2BtF\"};formData={email:email,password:password};_context.next=6;return fetch(apiUrl,{method:\"POST\",headers:headers,body:JSON.stringify(formData)});case 6:response=_context.sent;_context.next=9;return response.json();case 9:data=_context.sent;console.log(\"logged user:\",data);if(data.get_user_id&&data.get_user_id.length>0){userId=data.get_user_id[0].id;console.log(typeof userId);// const userId = data.get_user_id[0].id;\nsetIsAdmin(userId===3);setCurrentUser(userId);setIsLoggedIn(true);setError(\"\");}else{// Invalid credentials\nsetError(\"Invalid credentials. Please try again.\");setIsLoggedIn(false);// Set isLoggedIn to false\n}_context.next=19;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.error(\"Error fetching user ID:\",_context.t0);setError(\"Error fetching user ID. Please try again.\");setIsLoggedIn(false);// Set isLoggedIn to false\ncase 19:case\"end\":return _context.stop();}},_callee,null,[[0,14]]);}));return function login(_x,_x2){return _ref2.apply(this,arguments);};}();var logout=function logout(){setIsLoggedIn(false);setIsAdmin(false);setCurrentUser(null);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{currentUser:currentUser,isAdmin:isAdmin,isLoggedIn:isLoggedIn,login:login,logout:logout,error:error},children:children});};var useAuth=function useAuth(){return useContext(AuthContext);};export{AuthProvider,useAuth};","map":{"version":3,"names":["React","createContext","useState","useContext","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","currentUser","setCurrentUser","_useState3","_useState4","isAdmin","setIsAdmin","_useState5","_useState6","isLoggedIn","setIsLoggedIn","_useState7","_useState8","error","setError","login","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","email","password","apiUrl","headers","formData","response","data","userId","wrap","_callee$","_context","prev","next","fetch","method","body","JSON","stringify","sent","json","console","log","get_user_id","length","id","t0","stop","_x","_x2","apply","arguments","logout","Provider","value","useAuth"],"sources":["/home/workspace/reactjs/coding-practices/transactionmanagementapp/src/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext } from \"react\";\n\nconst AuthContext = createContext();\n\nconst AuthProvider = ({ children }) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const login = async (email, password) => {\n    try {\n      const apiUrl =\n        \"https://bursting-gelding-24.hasura.app/api/rest/get-user-id\";\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        \"x-hasura-admin-secret\":\n          \"g08A3qQy00y8yFDq3y6N1ZQnhOPOa4msdie5EtKS1hFStar01JzPKrtKEzYY2BtF\",\n      };\n\n      const formData = {\n        email: email,\n        password: password,\n      };\n\n      const response = await fetch(apiUrl, {\n        method: \"POST\",\n        headers: headers,\n        body: JSON.stringify(formData),\n      });\n\n      const data = await response.json();\n      console.log(\"logged user:\", data);\n\n      if (data.get_user_id && data.get_user_id.length > 0) {\n        const userId = data.get_user_id[0].id;\n        console.log(typeof userId);\n        // const userId = data.get_user_id[0].id;\n        setIsAdmin(userId === 3);\n        setCurrentUser(userId);\n        setIsLoggedIn(true);\n        setError(\"\");\n      } else {\n        // Invalid credentials\n        setError(\"Invalid credentials. Please try again.\");\n        setIsLoggedIn(false); // Set isLoggedIn to false\n      }\n    } catch (error) {\n      console.error(\"Error fetching user ID:\", error);\n      setError(\"Error fetching user ID. Please try again.\");\n      setIsLoggedIn(false); // Set isLoggedIn to false\n    }\n  };\n\n  const logout = () => {\n    setIsLoggedIn(false);\n    setIsAdmin(false);\n    setCurrentUser(null);\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{ currentUser, isAdmin, isLoggedIn, login, logout, error }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nconst useAuth = () => {\n  return useContext(AuthContext);\n};\n\nexport { AuthProvider, useAuth };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}